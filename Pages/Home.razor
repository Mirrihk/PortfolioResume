@page "/"
@layout MainLayout
@inject NavigationManager Nav
@inject IJSRuntime JS
@using Microsoft.AspNetCore.WebUtilities

<PageTitle>Portfolio</PageTitle>

@if (!ShowContent)
{
    <p>Checking login status...</p>
}
else
{
    <div class="page-container">
        <div class="responsive-panel">

            <h2>Welcome, @Username!</h2>
            <h3>Sebastian Alvarez</h3>


            <div class="content-section">
                <h3>Developer Summary</h3>
                <p>
                    Software developer with expertise in C#, Blazor, and Python, creating performant 
                    web applications and automation tools with clean, maintainable code.
                </p>
            </div>
            
            <div class="skills">
                <h3>Skills & Expertise</h3>
                <ul class="skills">
                    <li>C# & .NET</li>
                    <li>Python</li>
                    <li>HTML, CSS</li>
                    <li>Azure</li>
                    <li>SQL</li>
                    <li>Docker, Git, CI/CD (GitHub Actions)</li>
                    <li>RESTful APIs & Web Security</li>
                </ul>
            </div>

            <div class="content-section stats-flex">
                <div class="stats-card">
                    <h3>GitHub Contributions</h3>
                    <a href="https://github.com/Mirrihk" target="_blank" rel="noopener noreferrer">
                        <img src="https://ghchart.rshah.org/Mirrihk"
                             alt="GitHub contributions chart" />
                    </a>
                </div>

                <div class="stats-card">
                    <h3>LeetCode Stats</h3>
                    <a href="https://leetcode.com/u/sebas6721" target="_blank" rel="noopener noreferrer">
                        <img src="https://leetcode-stats.vercel.app/api?username=sebas6721&theme=Dark"
                             alt="LeetCode stats card" />
                    </a>
                </div>
            </div>



            <button class="logout-btn" @onclick="HandleLogout">Logout</button>

        </div>
    </div>
}

@code {
    private string Username { get; set; } = "Guest";
    bool ShowContent = false;

    private async Task HandleLogout()
    {
        await JS.InvokeVoidAsync("localStorage.removeItem", "isLoggedIn");
        await JS.InvokeVoidAsync("localStorage.removeItem", "username");
        Nav.NavigateTo("/password", forceLoad: true);
    }

    protected override async Task OnInitializedAsync()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = QueryHelpers.ParseQuery(uri.Query);

        if (query.TryGetValue("guest", out var guestFlag) && guestFlag == "true")
        {
            ShowContent = true;
            return;
        }

        var isLoggedIn = await JS.InvokeAsync<string>("localStorage.getItem", "isLoggedIn");
        if (isLoggedIn == "true")
        {
            var storedUsername = await JS.InvokeAsync<string>("localStorage.getItem", "username");
            if (!string.IsNullOrWhiteSpace(storedUsername))
                Username = storedUsername;

            ShowContent = true;
        }
        else
        {
            Nav.NavigateTo("/password");
        }
    }
}
